<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.loushuiyifan.data.dao.DataDAO">

    <select id="da1" resultType="com.loushuiyifan.data.vo.MonthData">
      select *
      from total_main_income_FX
      order by acct_month asc
    </select>


    <select id="da2_listIncomeSource" resultType="com.loushuiyifan.data.vo.DataAnalysis2">
        select
        <choose>
            <when test="sourceId!=null and !sourceId.isEmpty()">
                CODE_ID as "id",
                CODE_NAME as "name",
            </when>
            <otherwise>
                b.parent_code_name as "name",
                b.parent_code_id as "id",
            </otherwise>
        </choose>
        sum(case
        when substr(a.acct_month, 5, 2) = '01' then
        AFT_AMOUNT
        else
        0
        end) as "a01",
        sum(case
        when substr(a.acct_month, 5, 2) = '02' then
        AFT_AMOUNT
        else
        0
        end) as "a02",
        sum(case
        when substr(a.acct_month, 5, 2) = '03' then
        AFT_AMOUNT
        else
        0
        end) as "a03",
        sum(case
        when substr(a.acct_month, 5, 2) = '04' then
        AFT_AMOUNT
        else
        0
        end) as "a04",
        sum(case
        when substr(a.acct_month, 5, 2) = '05' then
        AFT_AMOUNT
        else
        0
        end) as "a05",
        sum(case
        when substr(a.acct_month, 5, 2) = '06' then
        AFT_AMOUNT
        else
        0
        end) as "a06",
        sum(case
        when substr(a.acct_month, 5, 2) = '07' then
        AFT_AMOUNT
        else
        0
        end) as "a07",
        sum(case
        when substr(a.acct_month, 5, 2) = '08' then
        AFT_AMOUNT
        else
        0
        end) as "a08",
        sum(case
        when substr(a.acct_month, 5, 2) = '09' then
        AFT_AMOUNT
        else
        0
        end) as "a09",
        sum(case
        when substr(a.acct_month, 5, 2) = '10' then
        AFT_AMOUNT
        else
        0
        end) as "a10",
        sum(case
        when substr(a.acct_month, 5, 2) = '11' then
        AFT_AMOUNT
        else
        0
        end) as "a11",
        sum(case
        when substr(a.acct_month, 5, 2) = '12' then
        AFT_AMOUNT
        else
        0
        end) as "a12"
        from income_source_pd_data_fx a, income_fx_source_config_new b
        where a.datasource_id = b.code_id
        and a.acct_month <![CDATA[ >= ]]>
        to_char(trunc(to_date(#{month}, 'yyyymm'), 'yyyy'), 'yyyymm')
        and a.acct_month <![CDATA[ <= ]]> #{month}
        <if test="productId!=null and !productId.isEmpty()">
            and index_Id=#{productId}
        </if>
        <if test="latnId!=null and !latnId.isEmpty()">
            and latn_id=#{latnId}
        </if>
        <if test="latnId2!=null and !latnId2.isEmpty()">
            and area_id=#{latnId2}
        </if>
        <if test="sourceId!=null and !sourceId.isEmpty()">
            and b.parent_code_id=#{sourceId}
        </if>
        group by b.parent_code_name,
        b.parent_code_id,
        ORDER_PARENT_ID
        <choose>
            <when test="sourceId!=null and !sourceId.isEmpty()">
                ,
                CODE_ID,
                CODE_NAME
                order by b.CODE_ID asc
            </when>
            <otherwise>
                order by ORDER_PARENT_ID asc
            </otherwise>
        </choose>
    </select>

    <select id="da2_listProduct" resultType="com.loushuiyifan.data.vo.DataAnalysis2">
        select b.index_name as "name",
        b.index_Id as "id",
        b.type_flg as "type",
        sum(case
        when substr(a.acct_month, 5, 2) = '01' then
        AFT_AMOUNT
        else
        0
        end) as "a01",
        sum(case
        when substr(a.acct_month, 5, 2) = '02' then
        AFT_AMOUNT
        else
        0
        end) as "a02",
        sum(case
        when substr(a.acct_month, 5, 2) = '03' then
        AFT_AMOUNT
        else
        0
        end) as "a03",
        sum(case
        when substr(a.acct_month, 5, 2) = '04' then
        AFT_AMOUNT
        else
        0
        end) as "a04",
        sum(case
        when substr(a.acct_month, 5, 2) = '05' then
        AFT_AMOUNT
        else
        0
        end) as "a05",
        sum(case
        when substr(a.acct_month, 5, 2) = '06' then
        AFT_AMOUNT
        else
        0
        end) as "a06",
        sum(case
        when substr(a.acct_month, 5, 2) = '07' then
        AFT_AMOUNT
        else
        0
        end) as "a07",
        sum(case
        when substr(a.acct_month, 5, 2) = '08' then
        AFT_AMOUNT
        else
        0
        end) as "a08",
        sum(case
        when substr(a.acct_month, 5, 2) = '09' then
        AFT_AMOUNT
        else
        0
        end) as "a09",
        sum(case
        when substr(a.acct_month, 5, 2) = '10' then
        AFT_AMOUNT
        else
        0
        end) as "a10",
        sum(case
        when substr(a.acct_month, 5, 2) = '11' then
        AFT_AMOUNT
        else
        0
        end) as "a11",
        sum(case
        when substr(a.acct_month, 5, 2) = '12' then
        AFT_AMOUNT
        else
        0
        end) as "a12"
        from income_source_pd_data_fx a,
        income_fx_source_pd_config b
        <if test="sourceId!=null and !sourceId.isEmpty()">
            ,
            income_fx_source_config_new c
        </if>
        where a.index_Id = b.index_Id
        and a.acct_month <![CDATA[ >= ]]>
        to_char(trunc(to_date(#{month}, 'yyyymm'), 'yyyy'), 'yyyymm')
        and a.acct_month <![CDATA[ <= ]]> #{month}
        <if test="latnId!=null and !latnId.isEmpty()">
            and latn_id = #{latnId}
        </if>
        <if test="latnId2!=null and !latnId2.isEmpty()">
            and area_id = #{latnId2}
        </if>
        <if test="sourceId!=null and !sourceId.isEmpty()">
            and a.datasource_id = c.code_id
            and c.parent_code_id = #{sourceId}
        </if>
        <if test="sourceId2!=null and !sourceId2.isEmpty()">
            and c.code_id = #{sourceId2}
        </if>
        group by b.index_name, b.index_Id, b.type_flg, b.order_Id
        order by b.index_Id
    </select>

    <select id="da2_listLatn" resultType="com.loushuiyifan.data.vo.DataAnalysis2">
        select
        <choose>
            <when test="latnId!=null and !latnId.isEmpty()">
                a.area_id as "id",
                b.area_name_c4 as "name",
            </when>
            <otherwise>
                b.area_name_lv3 as "name",
                a.latn_Id as "id",
            </otherwise>
        </choose>
        sum(case
        when substr(a.acct_month, 5, 2) = '01' then
        AFT_AMOUNT
        else
        0
        end) as "a01",
        sum(case
        when substr(a.acct_month, 5, 2) = '02' then
        AFT_AMOUNT
        else
        0
        end) as "a02",
        sum(case
        when substr(a.acct_month, 5, 2) = '03' then
        AFT_AMOUNT
        else
        0
        end) as "a03",
        sum(case
        when substr(a.acct_month, 5, 2) = '04' then
        AFT_AMOUNT
        else
        0
        end) as "a04",
        sum(case
        when substr(a.acct_month, 5, 2) = '05' then
        AFT_AMOUNT
        else
        0
        end) as "a05",
        sum(case
        when substr(a.acct_month, 5, 2) = '06' then
        AFT_AMOUNT
        else
        0
        end) as "a06",
        sum(case
        when substr(a.acct_month, 5, 2) = '07' then
        AFT_AMOUNT
        else
        0
        end) as "a07",
        sum(case
        when substr(a.acct_month, 5, 2) = '08' then
        AFT_AMOUNT
        else
        0
        end) as "a08",
        sum(case
        when substr(a.acct_month, 5, 2) = '09' then
        AFT_AMOUNT
        else
        0
        end) as "a09",
        sum(case
        when substr(a.acct_month, 5, 2) = '10' then
        AFT_AMOUNT
        else
        0
        end) as "a10",
        sum(case
        when substr(a.acct_month, 5, 2) = '11' then
        AFT_AMOUNT
        else
        0
        end) as "a11",
        sum(case
        when substr(a.acct_month, 5, 2) = '12' then
        AFT_AMOUNT
        else
        0
        end) as "a12"
        from income_source_pd_data_fx a,
        dim_c4_map_only_area b
        <if test="sourceId!=null and !sourceId.isEmpty()">
            ,
            income_fx_source_config_new c
        </if>
        where a.area_Id = b.area_Id_c4
        and a.acct_month <![CDATA[ >= ]]>
        to_char(trunc(to_date(#{month}, 'yyyymm'), 'yyyy'), 'yyyymm')
        and a.acct_month <![CDATA[ <= ]]> #{month}
        <if test="latnId!=null and !latnId.isEmpty()">
            and a.latn_id = #{latnId}
        </if>
        <if test="productId!=null and !productId.isEmpty()">
            and index_Id = #{productId}
        </if>
        <if test="sourceId!=null and !sourceId.isEmpty()">
            and a.datasource_id = c.code_id
            and c.parent_code_id = #{sourceId}
        </if>
        <if test="sourceId2!=null and !sourceId2.isEmpty()">
            and c.code_id = #{sourceId2}
        </if>
        group by b.area_name_lv3,
        a.latn_Id,
        <choose>
            <when test="latnId!=null and !latnId.isEmpty()">
                a.area_id,
                b.area_name_c4
                order by a.area_id asc
            </when>
            <otherwise>
                b.c3_order_Id
                order by b.c3_order_Id asc
            </otherwise>
        </choose>
    </select>

    <select id="da3" resultType="com.loushuiyifan.data.vo.DataAnalysis3">
select
        <choose>
            <when test="latnId!=null and !latnId.isEmpty()">
                area_Id as "id",
                area_name as "name",
            </when>
            <otherwise>
                latn_Id as "id",
                latn_name as "name",
            </otherwise>
        </choose>
       sum(LAST_YEAR_MONTH) as "lastYearMonth",
       sum(LAST_MONTH) as "lastMonth",
       sum(THIS_MONTH) as "thisMonth",
       sum(TOTAL_THIS_YEAR) as "totalThisYear",
       sum(TOTAL_LAST_YEAR) as "totalLastYear",
       sum(MONTH_BUDGET) as "monthBudget",
       sum(MONTH_BUDGET_GAP) as "monthBudgetGap"
  from area_MAIN_INCOME_FX
 where acct_month = #{month}
        <if test="latnId!=null and !latnId.isEmpty()">
            and latn_id = #{latnId}
        </if>
 group by order_id,
        <choose>
            <when test="latnId!=null and !latnId.isEmpty()">
                area_Id, area_name
            </when>
            <otherwise>
                latn_Id, latn_name
            </otherwise>
        </choose>
 order by order_id
    </select>

</mapper>