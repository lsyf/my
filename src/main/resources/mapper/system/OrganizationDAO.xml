<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.loushuiyifan.system.dao.OrganizationDAO">


    <select id="listOrganizationByParentId" resultType="com.loushuiyifan.common.bean.Organization">
       select name,data from aweb_organization a where a.parent_id = #{parentId}
    </select>

    <select id="listByLvl" resultType="com.loushuiyifan.common.bean.Organization">
        SELECT
            *
        FROM
            aweb_organization a
        WHERE
            a.lvl <![CDATA[ <= ]]> #{lvl}
        ORDER BY
            lvl ASC,
            a.sorting DESC
    </select>

    <select id="listNodesByPath" resultType="com.loushuiyifan.common.bean.Organization">
        SELECT
            *
        FROM
            aweb_organization
        WHERE
            parent_ids LIKE #{path}
        ORDER BY
            lvl ASC,
            sorting DESC
    </select>


    <delete id="deleteAllKids">
        delete
        from aweb_organization
        where parent_ids like #{path}
    </delete>

    <select id="countUserByOrgPath" resultType="int">
    SELECT
        COUNT(1)
    FROM
        aweb_organization a,
        aweb_user_organization b
    WHERE
        a.id = b.org_id
    AND a.parent_ids like #{path}
    </select>

    <select id="countUserByOrgId" resultType="int">
    SELECT
        COUNT(1)
    FROM
        aweb_user_organization
    WHERE
        org_id = #{id}
    </select>

    <select id="listByType" resultType="com.loushuiyifan.common.bean.Organization">
      select t.*
      from aweb_organization t
      where t.type = #{type}
    </select>

    <select id="listByTypeAndLvl" resultType="com.loushuiyifan.common.bean.Organization">
      select t.*
      from aweb_organization t
      where t.type = #{type}
      and t.lvl = #{lvl}
    </select>

    <select id="listFromCodeListTax" resultType="com.loushuiyifan.system.vo.CodeListTaxDTO">
        select * from code_list_tax a where a.type_code='local_net' and a.code_level = #{lvl}
    </select>

    <select id="listFromUserCompany" resultType="com.loushuiyifan.system.vo.UserCompany">
        select *
        from user_company a
    </select>

    <select id="getAllKidsByData" resultType="com.loushuiyifan.common.bean.Organization">
        select a.*
        from aweb_organization a
        where a.parent_id =
        (select id
        from aweb_organization
        where data = #{pData}
        and type = #{type})
        order by  a.lvl asc, a.sorting desc
    </select>
</mapper>