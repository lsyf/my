<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.loushuiyifan.task.dao.RptMsgInfoDataDAO">
	<select id="getFileInfoseq" resultType="java.lang.Long">
		select file_id.nextval from dual
	</select>
	<select id="queryFileInfo" resultType="com.loushuiyifan.task.bean.FileInfoData">
	
	select * from file_info
		where file_type=#{fileType}
		and file_date=#{fileDate}
		and rpt_type=#{rptType}
		and interFaceType=#{interFaceType}
	</select>
	
	<select id="listData" resultType="java.util.HashMap">
		select INCOME_SOURCE as "incomeSource",
		       latnId,
		       subId 
		 from STAT_TO_GROUP
		  where acct_month=#{month} 
		  and BATCHID=#{batchId}
		  and status='P1' 
		  and rpt_type='1' 
	
	</select>	
	<select id="listStatTaxForMap" resultType="com.loushuiyifan.task.bean.StatToTaxData">
	select DOCUM_SER_NBR as "documSerNbr",
		VOUCHER_ROW_NBR  as "voucherRowNbr",
		GJAHR,
		MONAT,
		BUKRS,
		PRCTR,
		WWA04,
		NSSBH,
		WWA09,
		SWKM,
		SFYYWSR,
		SRLX,
		SYSZ,
		SBFS,
		JSFF,
		YSLB,
		SFJZJT,
		SLV,
		CRNCY_AMT as "crncyAmt",
		nvl(SWSRJE,0),
		SWSRSE,
		SFSTXS,
		SWTZLX,
		SWTZYY,
		JFSSSJ,
		JSSWKM,
		nvl(JFSL,0)
		from STAT_TO_TAX
		where REMARK =#{remark}
		and
		GJAHR||MONAT =#{month}
	
	</select>
	<select id="selectBatchIds" resultType="String">
		select BATCHID from STAT_TO_GROUP
		where acct_month=#{month}
		and status='R'
		and rpt_type ='1'
	</select>
		
	<select id="getStatus" resultType="String">
		select status from
		STAT_TO_GROUP
		where BATCHID =#{batchId}
		and rpt_type =#{type} 
		and acct_month=#{month}	 
		order by SUBID desc
	</select>
	
	<delete id="delRptMsgInfo">
	delete from RPT_MSG_INFO 
		where BATCH_ID =#{batchId} 
		and BUSI_TYPE =#{type}
		and substr(file_name,33,6) =#{month}
	
	</delete>
	
	<delete id="deleteFileInfo">
	delete from file_info 
		where interFaceType =#{batchId}
		and rpt_type =#{type}
		and file_date =#{month}
	
	</delete>
	
	<update id="changeStatus">
		update STAT_TO_GROUP
		set status = #{status}
		where BATCHID = #{batchId}
		and ACCT_MONTH = #{month}
		and rpt_type in (0,1)
		and subid =
		(select max(subid)
		from STAT_TO_GROUP
		where BATCHID = #{batchId}
		and ACCT_MONTH = #{month})
	</update>
	
	<update id="changeStatusById">
		update RPT_MSG_INFO set state=#status# ,LST_UPD=sysdate where
		session_id=#{sessionId}
	</update>



</mapper>