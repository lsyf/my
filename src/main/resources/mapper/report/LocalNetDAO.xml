<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.loushuiyifan.report.dao.LocalNetDAO">

    <select id="listByUserAndLvl" resultType="com.loushuiyifan.common.bean.Organization">
        select a.*
        from aweb_organization a
        join aweb_user_organization b
        on a.id = b.org_id
        and b.user_id = #{userId}
        where  a.lvl <![CDATA[<=]]> #{lvl}
        and a.type = 'local_net'
    </select>

    <select id="listByRootAndLvl" resultType="com.loushuiyifan.common.bean.Organization">
        select  *
        from(
            select *
            from aweb_organization a
            where a.type = 'local_net'
            and a.lvl <![CDATA[<=]]> #{lvl}
            and (
            <foreach collection="list" item="org" separator="or">
                a.parent_ids like #{org.parentIds}
            </foreach>
            )
            union
            select *
            from aweb_organization a
            where a.type = 'local_net'
            and a.lvl <![CDATA[<=]]> #{lvl}
            and id in (
            <foreach collection="list" item="org" separator=",">
                #{org.id}
            </foreach>
            )
        ) a
        order by a.lvl asc, a.sorting desc
    </select>

    <select id="listForC3" resultType="com.loushuiyifan.common.bean.Organization">
        select  *
        from(
        select *
        from aweb_organization a
        where a.type = 'local_net'
        and a.lvl <![CDATA[<=]]> 3
        and (
        <foreach collection="list" item="org" separator="or">
            a.parent_ids like #{org.parentIds}
        </foreach>
        )
        union
        select *
        from aweb_organization a
        where a.type = 'local_net'
        and a.lvl <![CDATA[<=]]> 3
        and id in (
        <foreach collection="list" item="org" separator=",">
            #{org.id},#{org.parentId}
        </foreach>
        )
        ) a
        order by a.lvl asc, a.sorting desc
    </select>


    <select id="preForC3" resultType="com.loushuiyifan.common.bean.Organization">
		select a.*
		  from aweb_organization a
		  join aweb_organization b
		    on b.type = 'local_net'
		   and b.data = #{data}
		  join aweb_user_organization c
		    on a.id = c.org_id
		   and c.user_id = #{userId}
		 where a.lvl = 1
		    or (a.lvl = 2 and a.id = b.id)
		    or (a.lvl = 3 and a.parent_id = b.id)
		   and a.type = 'local_net'
		 order by a.lvl asc, a.sorting desc
    </select>
    
    <select id="getCodeNameById" resultType="String">
	    select a.code_name
	  from code_list_tax a
	 where a.type_code =#{typeCode}
	   and a.code_id = #{codeId}
    
    </select>
      
	<select id="listPrctrName" resultType="Map">
    	select distinct PRCTR  as "id", 
    	       PRCTR_NAME      as "name", 
    	       PRCTR           as "data"
    	from charge.RPT_BALANCE_CODE_DEF                
        where  PRCTR_NAME = #{name}
        
                  
    </select>
    
    <select id="listNameById" resultType="com.loushuiyifan.report.vo.CommonVO">
    
	select a.name, a.data
	  from aweb_organization a
	 where a.type = 'local_net' and a.lvl=3
    
    </select>

</mapper>