<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.loushuiyifan.report.dao.LocalNetDAO">

    <select id="listByUserAndLvl" resultType="com.loushuiyifan.common.bean.Organization">
        select a.*
        from aweb_organization a
        join aweb_user_organization b
        on a.id = b.org_id
        and b.user_id = #{userId}
        where  a.lvl <![CDATA[<=]]> #{lvl}
        and a.type = 'local_net'
    </select>

    <select id="listByRootAndLvl" resultType="Map">
        select
            a.name as "name",
            a.data as "data",
            a.parent_id as "pId",
            a.id as "id"
        from(
            select *
            from aweb_organization a
            where a.type = 'local_net'
            and a.lvl <![CDATA[<=]]> #{lvl}
            and (
            <foreach collection="list" item="org" separator="or">
                a.parent_ids like #{org.parentIds}
            </foreach>
            )
            union
            select *
            from aweb_organization a
            where a.type = 'local_net'
            and a.lvl <![CDATA[<=]]> #{lvl}
            and id in (
            <foreach collection="list" item="org" separator=",">
                #{org.id}
            </foreach>
            )
        ) a
        order by a.lvl asc, a.sorting desc
    </select>
</mapper>