<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.loushuiyifan.report.dao.RptRuleConfigDAO">


    <select id="listData" resultType="com.loushuiyifan.report.vo.RuleConfigVO">
		select a.id         as "logId",
		       a.acct_month as "month",
		       b.name       as "latnName",       
		       decode(a.area_id, 0, chr(51371) || chr(45759),
		       (select b.name from aweb_organization b where b.data = a.area_id))   as "codeName",     
		       (select c.card_name from charge.dim_card_def c where c.card_id = a.card_id) as "cardType",
		       a.rate            as "discount",		       
		       a.platform_amount as "platformAmount",
		       a.inactive_amount as "inactiveAmount",
		       (select d.nickname from aweb_user d where d.id = a.chg_who) as "chgWho",
		       to_char(a.lst_upd, 'yyyy-mm-dd hh24:mi:ss') as "lstUpd"
		  from (select t.* from charge.inet_discount_rate t where 1 = 1
		        
		        <if test='logId ==null'>
		        	and t.acct_month = #{month}
		        </if>
		        
		        <if test='logId !=null'>
		        	and t.id = #{logId}
		        </if>
		        <if test='discount !="".toString'>
		        	and t.rate = #{discount}
		        </if>
		        <if test='cardType !="0"'>
		        	and t.card_id = #{cardType}
		        </if>               
		        order by t.lst_upd desc) a,
		        dim_region_def b
		    where a.latn_id = b.id   
		   	<if test='latnId !="0"'>
		      and b.dept_id = #{latnId}
		    </if> 
		   
                 
	</select>
	
	
	<select id="findCardName" resultType="Map">
	 select a.card_id as "id", 
	 a.card_id || '-' || a.card_name as "name",
	 a.card_id as "data"
     from charge.dim_card_def a
    order by a.card_id
	</select>
	

	<select id="preForC3" resultType="com.loushuiyifan.common.bean.Organization">
		select a.*
		  from aweb_organization a
		  join aweb_organization b
		    on b.type = 'local_net'
		   and b.data =0
		  join aweb_user_organization c
		    on a.id = c.org_id
		   and c.user_id = #{userId}
		 where a.lvl = 1
		    or (a.lvl = 2 and a.id = b.id)
		    or (a.lvl = 3 and a.parent_id = b.id)
		   and a.type = 'local_net'
		 order by a.lvl asc, a.sorting desc
    </select>
    <select id="listAll" resultType="com.loushuiyifan.common.bean.Organization">
	select * from aweb_organization a where a.parent_id =5853 and data not in('5','3395','3396')
    order by a.lvl,a.sorting desc
    </select>
    <select id="listByRootAndLvl" resultType="com.loushuiyifan.common.bean.Organization">
        select *
        from(
        select *
        from aweb_organization a
        where a.type = 'local_net'
        and a.lvl = 3
        and a.id =#{id}
        union
        select *
        from aweb_organization a
        where a.type = 'local_net'
        and a.lvl = 4
        and a.parent_id =#{id}
        ) a
        order by a.lvl asc, a.sorting desc
    </select>
    
    
</mapper>