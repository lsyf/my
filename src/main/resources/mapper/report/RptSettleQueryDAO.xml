<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.loushuiyifan.report.dao.RptSettleQueryDAO">
	<select id="listData" resultType="com.loushuiyifan.report.vo.SettleDataVO" >
		select a.log_id as logId,
       a.REPORT_ID      as reportId,
       b.REPORT_name    as reportName,
       a.acct_month     as month,
       b.income_source    as incomeSource,
       decode(a.state, 0, '无', '1', '有数据') as status,      
       c.file_seq       as fileSeq,
       to_char(c.create_date, 'YYYY-MM-DD hh24:mi:ss') as createDate,
       to_char(c.import_date, 'YYYY-MM-DD hh24:mi:ss') as importDate
	  from rpt_sett_state a, rpt_sett_def b, rpt_sett_log c
	 where a.REPORT_ID = b.REPORT_ID
	   and a.log_id = c.log_id
	   and b.batch_id = c.batch_id
	   and a.acct_month = #{month}
	   and b.remark = 'Y'
	 	<if test='reportId !="0" '>
			and a.REPORT_ID = #{reportId}
		</if>
	 	order by b.remark DESC, a.report_id  
			
		
	</select> 
	<select id="listOld" resultType="Map">
	select * from rpt_sett_income_cut a 
		 where a.log_id= #{logId}
		 and a.BUKRS like '833%'
		 order by REMARK ASC
	
	</select>
	<select id="titleOld" resultType="Map">
		 select distinct c.rn2 as "id",
		        c.COLUMN_NAME  as "name",
		        c.rn1 
	      from rpt_sett_log a, rpt_sett_def b, v_rpt_sett_format c
	        where a.batch_id = b.batch_id
	        and b.report_id = c.SHEET_CODE
	        and a.log_id = #{logId}
	        order by c.rn1 ASC
	</select>
	<select id="detail" resultType="Map">
	select a.report_id as "reportId",
       a.report_name   as "reportName",
       a.acct_month    as "acctMonth",
       a.area_id       as "areaId",
       a.area_name     as "areaName",
       a.hor_code      as "horCode",
       a.ver_code      as "verCode",
       a.index_allis   as "indexAllis",
       a.income_source as "incomeSource",
       a.source_name   as "sourceName",
       a.index_data    as "indexData"
  from rpt_sett_import_data a, rpt_sett_state b
 where a.acct_month = b.acct_month
   and a.report_id = b.report_id
   and b.log_id = #{logId}
   and a.income_source = #{incomeSource}
	
	</select>
	<select id="listReportInfo" resultType="Map">
		select distinct 
		REPORT_ID as "id", 
		REPORT_ID || '-' || REPORT_NAME as "name",
		REPORT_ID as "data" 
		from rpt_sett_def
		order by REPORT_ID ASC
	</select>
	<select id="auditRpt" parameterType="com.loushuiyifan.report.dto.SPDataDTO"
            statementType="CALLABLE">
        {call PKG_RPT_SETT.auditRpt(
        #{userId,mode=IN,jdbcType=NUMERIC},
        #{rptCaseId,mode=IN,jdbcType=NUMERIC},
        #{status,mode=IN,jdbcType=VARCHAR},
        #{comment,mode=IN,jdbcType=VARCHAR},
        #{rtnCode,mode=OUT,jdbcType=NUMERIC},
        #{rtnMsg,mode=OUT,jdbcType=VARCHAR},
        #{rtnStatus,mode=OUT,jdbcType=VARCHAR}
        )}
    </select>
	<select id="selectAudits" parameterType="Map" statementType="CALLABLE">
      {#{list,mode=OUT,jdbcType=CURSOR,resultMap=rptAuditVO}= call PKG_RPT_SETT.getAuditInfo(
      #{rptCaseId,mode=IN,jdbcType=NUMERIC},
      #{month,mode=IN,jdbcType=VARCHAR},
      #{reportId,mode=IN,jdbcType=VARCHAR},
      #{incomeSource,mode=IN,jdbcType=VARCHAR}
      )}
    </select>
    <resultMap id="rptAuditVO" type="com.loushuiyifan.report.vo.RptAuditVO">
    </resultMap>
</mapper>