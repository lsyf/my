<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.loushuiyifan.report.dao.RptImportManageDAO">

	<select id="listForMap" resultType="Map">
	select t.log_id     as "logId",   
           t.acct_month as "month",
           (select c.nickname from aweb_user c where c.id = t.user_id) as "useName",
           (select a.code_name from code_list_tax a where a.type_code = 'local_net' 
           	and a.code_id =t.latn_id ) as "codeName",   
           (select b.code_name from code_list_tax b where b.type_code = 'income_source2017' 
            and b.code_id = t.income_soure) as "incomeSource",
		   t.file_name as "fileName",		
		   to_char(t.import_date, 'yyyy-MM-dd hh24:mi:ss') as "importDate",
		   t.export_desc  as "exportDesc" 
      from(select * from ext_import_log r    
       where r.type = 'rpt_import_data_channel'
      <if test='flag !="1"'>                 
          and r.latn_id in(
        <foreach collection="list" item="latnId" separator=",">
            #{latnId}
        </foreach>
        )
          	
	  </if>                       
      )t
	
	where t.import_date <![CDATA[>=]]> to_date(#{startDate}, 'yyyy-MM-dd hh24:mi')	
	and t.import_date <![CDATA[<=]]> to_date(#{endDate}, 'yyyy-MM-dd hh24:mi')	
	
	<if test='userName !=null and userName !=""'>
	and t.user_id in(select c.id from aweb_user c where c.username =#{userName})
	</if>
	<if test='fileName !=""'>
	and t.file_name like '%' ||#{fileName}|| '%'
	</if>
	order by t.log_id DESC	
	</select>
	
	<select id="selectLatnByuserId" resultType="java.lang.String">
	select a.data from 
		 aweb_organization a,
		 aweb_user_organization b
		 where a.id =b.org_id
		 and a.type ='local_net'
		 and b.user_id = #{userId}
	
	</select>
</mapper>
