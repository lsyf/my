<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.loushuiyifan.report.dao.RptImportDataChennelDAO">

    <select id="checkRptImportData" parameterType="com.loushuiyifan.report.dto.CheckDataDTO"
            statementType="CALLABLE">
        {call data_check_2017(
         #{logId,mode=IN,jdbcType=NUMERIC},
         #{rtnCode,mode=OUT,jdbcType=NUMERIC},
         #{rtnMeg,mode=OUT,jdbcType=VARCHAR})}
    </select>

    <delete id="deleteByLogId">
        delete
        from rpt_import_data_channel
        where log_id =#{logId}
    </delete>

    <select id="listIncomeDataLog" resultType="com.loushuiyifan.report.vo.IncomeDataLogVO">
        select b.log_id as "logId",
        b.file_name as "fileName",
        count(*) as "num",
        sum(a.index_data) as "sum",
        e.name as "city",
        b.user_id as "userId",
        decode(a.action, null, 'N', 'Y', 'Y') as "action",
        b.export_desc as "remark"
        from Rpt_Import_Data_Channel a,
        EXT_IMPORT_LOG          b,
        aweb_user               d,
        aweb_organization       e
        where a.acct_month = #{month}
        and a.log_id = b.log_id
        and b.user_id = #{userId}
        and b.type = #{type}
        and d.id = b.user_id
        and e.data = b.latn_id
        and e.type = 'local_net'
        group by a.action, b.log_id, b.file_name, e.name, b.user_id, b.export_desc
        order by a.action desc
    </select>

    
    <select id="selectAction" resultType="String">
        select distinct t.action
        from Rpt_Import_Data_Channel t
		where t.log_id = #{logId}
    </select>


    <select id="iseeC4Cut" parameterType="com.loushuiyifan.report.dto.IseeC4CutDTO"
            statementType="CALLABLE">
        {call pkg_shelly_dev2017.isee_cut(
        #{month,mode=IN,jdbcType=VARCHAR},
        #{logId,mode=IN,jdbcType=NUMERIC},
        #{rtnCode,mode=OUT,jdbcType=NUMERIC},
        #{rtnMeg,mode=OUT,jdbcType=VARCHAR})}
    </select>

    <select id="commitRptImportData" parameterType="com.loushuiyifan.report.dto.CheckDataDTO"
            statementType="CALLABLE">
        {call IndexToParentChannel_2017(
        #{logId,mode=IN,jdbcType=NUMERIC},
        #{rtnCode,mode=OUT,jdbcType=NUMERIC},
        #{rtnMeg,mode=OUT,jdbcType=VARCHAR})}
    </select>

    <select id="deleteImportData" parameterType="com.loushuiyifan.report.dto.DeleteImportDataDTO"
            statementType="CALLABLE">
        {call IRPT_DEL_DATA_CN2017(
        #{userId,mode=IN,jdbcType=NUMERIC},
        #{logId,mode=IN,jdbcType=NUMERIC},
        #{rtnCode,mode=OUT,jdbcType=NUMERIC},
        #{rtnMeg,mode=OUT,jdbcType=VARCHAR})}
    </select>

</mapper>


