<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.loushuiyifan.report.dao.RptImportDataICTDAO">


    <select id="checkImportData" parameterType="com.loushuiyifan.report.dto.SPDataDTO"
            statementType="CALLABLE">
        {call pro_data_check_icthis(
        #{logId,mode=IN,jdbcType=NUMERIC},
        #{rtnCode,mode=OUT,jdbcType=NUMERIC},
        #{rtnMsg,mode=OUT,jdbcType=VARCHAR})}
    </select>

    <select id="deleteImportData" parameterType="com.loushuiyifan.report.dto.SPDataDTO"
            statementType="CALLABLE">
        {call IRPT_DEL_ICTDATA(
        #{userId,mode=IN,jdbcType=NUMERIC},
        #{logId,mode=IN,jdbcType=NUMERIC},
        #{rtnCode,mode=OUT,jdbcType=NUMERIC},
        #{rtnMsg,mode=OUT,jdbcType=VARCHAR})}
    </select>

    <select id="listICTLog" resultType="com.loushuiyifan.report.vo.ImportDataLogVO">
        select b.log_id as "logId",
       b.file_name as "fileName",
       count(*) as "num",
       sum(a.index_data) as "sum",
       d.username as "userName",
       d.nickname as "action",
       b.export_desc as "remark"
  from Rpt_Import_Data_ICT a, EXT_IMPORT_LOG b, aweb_user d
 where a.acct_month = #{month}
   and a.log_id = b.log_id
   and b.user_id = #{userId}
   and b.type = #{type}
   and d.id = b.user_id
 group by  b.log_id,
          b.file_name,
          d.username,
          d.nickname,
          b.user_id,
          b.export_desc
        
    </select>


</mapper>


